<!DOCTYPE html>
<html lang="pt-pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>BlueLava Community - Perturba√ß√£o</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    :root{--primary:#4A90E2;--bg:#f4f7f6;--white:#fff;--text:#333}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Roboto,Arial,sans-serif}
    .wrap{max-width:980px;margin:22px auto;padding:0 16px}
    .card{background:#fff;border:1px solid #ececec;border-radius:12px;padding:18px;box-shadow:0 10px 26px rgba(0,0,0,.06)}
    .title{margin:8px 0 4px;font-size:1.6rem}
    .meta{color:#4A90E2;font-weight:700}
    .simple-box{margin-top:12px;background:#f3f8ff;border:1px solid #d5e6ff;border-radius:10px;padding:12px}
    .comments{margin-top:22px}
    .story-call{margin:0 0 12px;padding:10px 12px;background:#fff8e8;border:1px solid #ffe2a6;border-radius:8px;font-weight:700;color:#6a4a00}
    .like-popcorn{background:#fff3d9;color:#6a4a00;border:1px solid #ffd48a;border-radius:999px;padding:6px 12px;cursor:pointer;font-weight:700}
    input,textarea{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;font-family:inherit}
    textarea{min-height:130px;resize:vertical}
    button{background:var(--primary);color:#fff;border:none;border-radius:8px;padding:10px 14px;cursor:pointer;font-weight:700}
    .comment{background:#fafafa;border:1px solid #ececec;border-radius:10px;padding:12px;margin:10px 0}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .back{display:inline-block;margin-bottom:12px;text-decoration:none;color:#1a5eb8;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="community.html">‚Üê Voltar √† comunidade</a>

    <section class="card" id="detailsCard" style="display:none">
      <img id="dImage" src="" alt="Perturba√ß√£o" style="width:100%;height:280px;object-fit:cover;border-radius:10px">
      <h1 id="dTitle" class="title"></h1>
      <div id="dMeta" class="meta"></div>
      <p id="dDesc"></p>
      <p><strong>Defini√ß√£o:</strong> <span id="dDefinition"></span></p>
      <p><strong>Fonte cient√≠fica:</strong> <a id="dSource" href="#" target="_blank" rel="noopener noreferrer"></a></p>
      <div class="simple-box">
        <p style="margin:0 0 8px"><strong>Explica√ß√£o simples:</strong> <span id="dSimple"></span></p>
        <a href="#commentsCard" style="font-weight:700;color:#1a5eb8;text-decoration:none">Identificas-te com isto? Ir para coment√°rios ‚Üì</a>
      </div>
    </section>

    <section class="card comments" id="commentsCard" style="display:none">
      <h2>Coment√°rios da comunidade</h2>
      <p class="story-call">Conta a tua hist√≥ria ‚Äî podes publicar com nome ou em an√≥nimo.</p>
      <div class="row" style="margin-bottom:10px">
        <input id="nameInput" placeholder="Nome (opcional)">
        <label style="display:flex;align-items:center;gap:6px;white-space:nowrap"><input id="anonInput" type="checkbox"> Publicar em an√≥nimo</label>
      </div>
      <textarea id="textInput" placeholder="Partilha a tua hist√≥ria..."></textarea>
      <div style="text-align:right;margin-top:10px">
        <button id="sendBtn">Publicar coment√°rio</button>
      </div>
      <div id="commentsList" style="margin-top:14px"></div>
    </section>
  </div>

  <script>
    const disorders = [
      {
        id: 1,
        category: 'Stress',
        prevalencePt: 25,
        image: 'assets/images/stress.svg',
        shortDescription: 'Resposta f√≠sica e emocional a sobrecarga, comum em contextos de trabalho de alta press√£o.',
        definition: 'Stress psicol√≥gico √© uma resposta adaptativa do organismo a exig√™ncias percebidas como superiores aos recursos dispon√≠veis. Em exposi√ß√£o prolongada, associa-se a pior sa√∫de mental e f√≠sica.',
        simpleExplanation: 'No dia a dia, pode parecer que a cabe√ßa nunca desliga: irrita√ß√£o f√°cil, tens√£o no corpo, cansa√ßo constante e sensa√ß√£o de estar sempre no limite.',
        sourceLabel: 'APA - Stress effects on body',
        sourceUrl: 'https://www.apa.org/topics/stress/body'
      },
      {
        id: 2,
        category: 'Ansiedade',
        prevalencePt: 16.5,
        image: 'assets/images/ansiedade.svg',
        shortDescription: 'Preocupa√ß√£o excessiva, persistente e dif√≠cil de controlar, com sintomas f√≠sicos associados.',
        definition: 'As perturba√ß√µes de ansiedade incluem medo e preocupa√ß√£o desproporcionais, hipervigil√¢ncia e sintomas som√°ticos (por exemplo, palpita√ß√µes e tens√£o), com impacto funcional relevante.',
        simpleExplanation: 'Pode sentir-se como viver em alerta permanente: pensar no pior cen√°rio, dificuldade em relaxar, cora√ß√£o acelerado e preocupa√ß√£o que n√£o passa.',
        sourceLabel: 'NIMH - Anxiety Disorders',
        sourceUrl: 'https://www.nimh.nih.gov/health/topics/anxiety-disorders'
      },
      {
        id: 3,
        category: 'Burnout',
        prevalencePt: 10,
        image: 'assets/images/burnout.svg',
        shortDescription: 'Exaust√£o ligada ao trabalho, com distanciamento emocional e menor efic√°cia profissional.',
        definition: 'Burnout √© uma s√≠ndrome associada ao stress cr√≥nico no trabalho, marcada por exaust√£o, cinismo/distanciamento e redu√ß√£o de efic√°cia profissional.',
        simpleExplanation: '√â como acordar j√° sem energia para o trabalho, perder motiva√ß√£o e sentir que at√© tarefas simples ficam pesadas e dif√≠ceis de cumprir.',
        sourceLabel: 'WHO - Burn-out (ICD-11)',
        sourceUrl: 'https://www.who.int/standards/classifications/frequently-asked-questions/burn-out-an-occupational-phenomenon'
      },
      {
        id: 4,
        category: 'Depress√£o',
        prevalencePt: 7.9,
        image: 'assets/images/depressao.svg',
        shortDescription: 'Humor deprimido persistente, perda de interesse e altera√ß√µes de sono, energia e concentra√ß√£o.',
        definition: 'A depress√£o √© uma perturba√ß√£o mental com tristeza persistente e/ou anedonia, frequentemente acompanhada por altera√ß√µes do sono, apetite, energia, cogni√ß√£o e risco suicid√°rio.',
        simpleExplanation: 'No quotidiano, pode traduzir-se em tristeza constante, falta de vontade para coisas que antes davam prazer e sensa√ß√£o de vazio ou desesperan√ßa.',
        sourceLabel: 'WHO - Depressive disorder',
        sourceUrl: 'https://www.who.int/news-room/fact-sheets/detail/depression'
      },
      {
        id: 5,
        category: 'P√¢nico',
        prevalencePt: 4,
        image: 'assets/images/panico-jovem-peito.svg',
        shortDescription: 'Ataques s√∫bitos de medo intenso com sintomas f√≠sicos marcantes.',
        definition: 'A perturba√ß√£o de p√¢nico caracteriza-se por ataques de p√¢nico inesperados e recorrentes, seguidos de preocupa√ß√£o persistente com novos ataques e altera√ß√µes comportamentais.',
        simpleExplanation: 'Pode surgir como uma onda intensa e repentina de medo, com falta de ar, tontura e sensa√ß√£o de perder o controlo, mesmo sem perigo real imediato.',
        sourceLabel: 'NHS - Panic disorder',
        sourceUrl: 'https://www.nhs.uk/mental-health/conditions/panic-disorder/'
      },
      {
        id: 6,
        category: 'TOC',
        prevalencePt: 1.5,
        image: 'assets/images/toc-organizar-mesa.svg',
        shortDescription: 'Obsess√µes intrusivas e compuls√µes repetitivas para reduzir ansiedade.',
        definition: 'A perturba√ß√£o obsessivo-compulsiva envolve obsess√µes (pensamentos intrusivos) e/ou compuls√µes (rituais), clinicamente significativos e com preju√≠zo funcional.',
        simpleExplanation: 'Pode parecer uma necessidade dif√≠cil de controlar de repetir verifica√ß√µes ou rituais para aliviar ansiedade, mesmo sabendo que isso consome tempo e energia.',
        sourceLabel: 'NIMH - Obsessive-Compulsive Disorder',
        sourceUrl: 'https://www.nimh.nih.gov/health/topics/obsessive-compulsive-disorder-ocd'
      },
      {
        id: 7,
        category: 'Esquizofrenia',
        prevalencePt: 0.43,
        image: 'assets/images/esquizofrenia-ouvidos.svg',
        shortDescription: 'Perturba√ß√£o grave com poss√≠veis alucina√ß√µes, del√≠rios e desorganiza√ß√£o do pensamento.',
        definition: 'A esquizofrenia √© uma perturba√ß√£o mental grave, heterog√©nea, com sintomas psic√≥ticos e altera√ß√µes cognitivas/funcionais que exigem acompanhamento cl√≠nico cont√≠nuo.',
        simpleExplanation: 'Em termos pr√°ticos, a pessoa pode ter experi√™ncias muito reais para si (como ouvir vozes), dificuldade em organizar pensamentos e maior necessidade de apoio cl√≠nico regular.',
        sourceLabel: 'WHO - Schizophrenia',
        sourceUrl: 'https://www.who.int/news-room/fact-sheets/detail/schizophrenia'
      }
    ];

    function getId() {
      const params = new URLSearchParams(window.location.search);
      return Number(params.get('id'));
    }

    function commentsKey(id) {
      return `bluelava_comments_${id}`;
    }

    function loadComments(id) {
      try {
        return JSON.parse(localStorage.getItem(commentsKey(id)) || '[]');
      } catch (error) {
        return [];
      }
    }

    function saveComments(id, comments) {
      localStorage.setItem(commentsKey(id), JSON.stringify(comments));
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function renderComments(disorderId) {
      const comments = loadComments(disorderId);
      const list = document.getElementById('commentsList');
      if (comments.length === 0) {
        list.innerHTML = '<p>Ainda n√£o h√° coment√°rios. S√™ a primeira pessoa a partilhar.</p>';
        return;
      }

      list.innerHTML = comments.map(function(comment) {
        const author = comment.anonymous ? 'An√≥nimo' : (comment.name || 'Sem nome');
        return `
          <article class="comment">
            <div class="row">
              <strong>${escapeHtml(author)}</strong>
              <small>${new Date(comment.createdAt).toLocaleString('pt-PT')}</small>
            </div>
            <p style="margin:8px 0 10px">${escapeHtml(comment.text)}</p>
            <button class="like-popcorn" onclick="likeComment(${disorderId}, ${comment.id})">üçø ${comment.likes}</button>
          </article>
        `;
      }).join('');
    }

    function likeComment(disorderId, commentId) {
      const comments = loadComments(disorderId);
      const item = comments.find(function(entry) { return entry.id === commentId; });
      if (!item) return;
      item.likes = (item.likes || 0) + 1;
      saveComments(disorderId, comments);
      renderComments(disorderId);
    }

    function bindForm(disorderId) {
      document.getElementById('sendBtn').addEventListener('click', function() {
        const name = document.getElementById('nameInput').value.trim();
        const anonymous = document.getElementById('anonInput').checked;
        const text = document.getElementById('textInput').value;

        if (!text || !text.trim()) {
          alert('Escreve um coment√°rio antes de publicar.');
          return;
        }

        const comments = loadComments(disorderId);
        comments.unshift({
          id: Date.now(),
          name,
          anonymous,
          text,
          likes: 0,
          createdAt: Date.now()
        });

        saveComments(disorderId, comments);
        document.getElementById('textInput').value = '';
        renderComments(disorderId);
      });
    }

    function render() {
      const id = getId();
      const disorder = disorders.find(function(item) { return item.id === id; });
      if (!disorder) {
        document.querySelector('.wrap').innerHTML = '<p>Perturba√ß√£o n√£o encontrada. <a href="community.html">Voltar</a></p>';
        return;
      }

      document.title = `BlueLava - ${disorder.category}`;
      const detailImage = document.getElementById('dImage');
      detailImage.src = disorder.image;
      detailImage.alt = disorder.category;
      document.getElementById('dTitle').textContent = disorder.category;
      document.getElementById('dMeta').textContent = `üáµüáπ ${disorder.prevalencePt}% da popula√ß√£o portuguesa`;
      document.getElementById('dDesc').textContent = disorder.shortDescription;
      document.getElementById('dDefinition').textContent = disorder.definition;
      document.getElementById('dSimple').textContent = disorder.simpleExplanation;
      document.getElementById('dSource').href = disorder.sourceUrl;
      document.getElementById('dSource').textContent = disorder.sourceLabel;

      document.getElementById('detailsCard').style.display = 'block';
      document.getElementById('commentsCard').style.display = 'block';

      bindForm(id);
      renderComments(id);
    }

    render();
    window.likeComment = likeComment;
  </script>
</body>
</html>
