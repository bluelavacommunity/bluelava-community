<!DOCTYPE html>
<html lang="pt-pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>BlueLava Community - Comunidade</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&family=Patrick+Hand&display=swap" rel="stylesheet">
  <style>
    :root{--primary:#4A90E2;--accent:#FF5722;--bg:#f4f7f6;--white:#fff;--text:#333}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);font-family:Roboto,Arial,sans-serif}
    header{background:linear-gradient(180deg,#000f2a,#2b4cb8);color:#fff;padding:24px;text-align:center}
    .stats-banner{background:var(--accent);color:#fff;padding:10px;text-align:center;font-weight:700}
    #chart-section{width:100%;background:linear-gradient(180deg,#fff,#f7fbff);padding:18px 0}
    #chart-canvas{width:100%;max-width:900px;margin:0 auto}
    .container{max-width:1100px;margin:20px auto;padding:0 18px}
    nav{background:#fff;position:sticky;top:0;padding:8px 0;box-shadow:0 4px 10px rgba(0,0,0,0.04)}
    .posts-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:20px}
    .post-card{background:#fff;border-radius:10px;padding:14px;box-shadow:0 6px 18px rgba(0,0,0,0.04);cursor:pointer}
    .post-title{font-weight:700;margin:6px 0}
    .post-portugal{color:var(--primary);font-weight:700}
    @media(max-width:700px){#chart-canvas{padding:0 12px}}
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;justify-content:center;gap:18px;flex-wrap:wrap">
      <img src="logo.png" alt="logo" style="max-width:140px;display:block;margin:0">
      <div style="font-weight:700;font-size:1.1rem">Comunidade Blue Lava</div>
      <div style="margin-left:8px;display:flex;gap:8px;align-items:center">
        <a href="#" aria-label="WhatsApp" style="color:#fff;text-decoration:none"><i class="fa-brands fa-whatsapp" style="font-size:18px"></i></a>
        <a href="#" aria-label="Discord" style="color:#fff;text-decoration:none"><i class="fa-brands fa-discord" style="font-size:18px"></i></a>
      </div>
    </div>
  </header>
  <div class="stats-banner">‚ö†Ô∏è Estat√≠stica Nacional: 1 em cada 5 pessoas em Portugal sofre de uma perturba√ß√£o mental.</div>

  <section id="chart-section">
    <div id="chart-canvas">
      <canvas id="prevalenceChart"></canvas>
    </div>
  </section>

  <nav>
    <div class="container" style="display:flex;gap:12px;align-items:center;overflow:auto">
      <a onclick="filterPosts('all')" style="font-weight:700;cursor:pointer">In√≠cio</a>
      <a onclick="filterPosts('Ansiedade')" style="cursor:pointer">Ansiedade</a>
      <a onclick="filterPosts('Esquizofrenia')" style="cursor:pointer">Esquizofrenia</a>
      <a onclick="filterPosts('Depress√£o')" style="cursor:pointer">Depress√£o</a>
    </div>
  </nav>

  <main class="container">
    <div id="posts-grid" class="posts-grid"></div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const prevalence = {
      'Ansiedade': {pt:16.5, world:4.4},
      'Depress√£o': {pt:7.9, world:5.7},
      'TOC': {pt:1.5, world:1.2},
      'P√¢nico': {pt:4, world:1.1},
      'Esquizofrenia': {pt:0.43, world:0.29},
      'Stress': {pt:25, world:8},
      'Burnout': {pt:10, world:3}
    };

    const posts = [
      {id:1,category:'Ansiedade',title:'Perturba√ß√µes de Ansiedade',stat:'Sintomas comuns',img:'https://source.unsplash.com/600x400/?anxiety,mental',desc:'Preocupa√ß√£o excessiva',fullText:'Perturba√ß√µes de ansiedade caracterizam-se por preocupa√ß√£o excessiva, apreens√£o e sintomas f√≠sicos como palpita√ß√µes. Fonte: Organiza√ß√£o Mundial da Sa√∫de (WHO).',source:'https://www.who.int',comments:[]},
      {id:2,category:'Depress√£o',title:'Perturba√ß√µes Depressivas',stat:'Sintomas comuns',img:'https://source.unsplash.com/600x400/?depression,sadness',desc:'Tristeza persistente',fullText:'A depress√£o √© caracterizada por tristeza persistente, perda de interesse e altera√ß√µes no sono e apetite. Fonte: WHO, WebMD.',source:'https://www.who.int',comments:[]},
      {id:3,category:'TOC',title:'Perturba√ß√£o Obsessivo-Compulsiva',stat:'Sintomas comuns',img:'https://source.unsplash.com/600x400/?obsessive,compulsive',desc:'Rituais e obsess√µes',fullText:'O TOC envolve pensamentos intrusivos recorrentes e comportamentos repetitivos (rituais). Fonte: WebMD.',source:'https://www.webmd.com',comments:[]},
      {id:4,category:'P√¢nico',title:'Perturba√ß√µes de P√¢nico',stat:'Sintomas comuns',img:'https://source.unsplash.com/600x400/?panic,anxiety',desc:'Ataques s√∫bitos de medo',fullText:'Ataques de p√¢nico s√£o epis√≥dios intensos de ansiedade com sintomas f√≠sicos intensos. Fonte: WHO, NHS.',source:'https://www.nhs.uk',comments:[]},
      {id:5,category:'Esquizofrenia',title:'Esquizofrenia',stat:'Doen√ßa grave',img:'https://source.unsplash.com/600x400/?schizophrenia,mental',desc:'Alucina√ß√µes e del√≠rios',fullText:'A esquizofrenia √© uma perturba√ß√£o mental grave que pode incluir alucina√ß√µes, del√≠rios e altera√ß√µes no pensamento. Fonte: WHO.',source:'https://www.who.int',comments:[]}
    ];

    let prevalenceChart;
    function renderChart(){
      const labels = Object.keys(prevalence);
      const ptData = labels.map(l=>prevalence[l].pt);
      const worldData = labels.map(l=>prevalence[l].world);
      const ctx = document.getElementById('prevalenceChart').getContext('2d');
      if(prevalenceChart) prevalenceChart.destroy();
      prevalenceChart = new Chart(ctx,{type:'bar',data:{labels, datasets:[{label:'Portugal (%)',data:ptData, backgroundColor:'rgba(141,198,255,0.9)'},{label:'Mundo (%)',data:worldData, backgroundColor:'rgba(10,73,150,0.9)'}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true}}}});
    }

    function filterPosts(cat){
      const grid = document.getElementById('posts-grid');grid.innerHTML='';
      const filtered = cat==='all'?posts:posts.filter(p=>p.category===cat);
      filtered.forEach(p=>{
        const perc = prevalence[p.category]?prevalence[p.category].pt:0;
        const imgHTML = p.img?`<img src="${p.img}" alt="${p.title}" style="width:100%;height:140px;object-fit:cover;border-radius:8px;margin-bottom:10px">`:'';
        grid.innerHTML+=`<div class="post-card" onclick="openPost(${p.id})">${imgHTML}<div class="post-title">${p.title}</div><div class="post-portugal">üáµüáπ ${perc}% da popula√ß√£o portuguesa</div><div>${p.desc}</div></div>`});
    }

    // --- Post view / comments ---
    // Modal overlay markup (injected)
    const postViewHTML = `
      <div id="postView" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:80;padding:24px">
        <div style="max-width:900px;width:100%;background:#fff;border-radius:12px;padding:20px;overflow:auto;max-height:90vh">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div style="font-weight:700;font-size:1.1rem" id="pvTitle"></div>
            <button onclick="closePostView()" style="background:transparent;border:none;font-size:18px;cursor:pointer">Fechar ‚úï</button>
          </div>
          <img id="pvImg" src="" style="width:100%;height:220px;object-fit:cover;border-radius:8px;margin-bottom:12px" />
          <div id="pvMeta" style="margin-bottom:12px;color:#555"></div>
          <div id="pvDefinition" style="margin-bottom:18px"></div>
          <hr />
          <h3 style="margin-top:14px">Conta a tua hist√≥ria</h3>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
            <input id="commentName" placeholder="Nome (opcional)" style="flex:1;padding:8px;border-radius:6px;border:1px solid #ddd"> 
            <label style="display:flex;align-items:center;gap:6px"><input id="commentAnon" type="checkbox"> An√≥nimo</label>
          </div>
          <textarea id="commentText" placeholder="Partilha a tua experi√™ncia" style="width:100%;height:100px;padding:10px;border-radius:8px;border:1px solid #ddd"></textarea>
          <div style="text-align:right;margin-top:8px"><button id="submitComment" style="background:var(--primary);color:#fff;padding:8px 14px;border-radius:8px;border:none;cursor:pointer">Enviar</button></div>
          <div id="commentsList" style="margin-top:18px"></div>
        </div>
      </div>
    `;
    document.body.insertAdjacentHTML('beforeend', postViewHTML);

    function closePostView(){ document.getElementById('postView').style.display='none'; }

    function openPost(id){
      const post = posts.find(p=>p.id===id); if(!post) return;
      document.getElementById('pvTitle').textContent = post.title;
      document.getElementById('pvImg').src = post.img || '';
      const perc = prevalence[post.category]?prevalence[post.category].pt:0;
      document.getElementById('pvMeta').innerHTML = `üáµüáπ ${perc}% da popula√ß√£o portuguesa ‚Ä¢ <a href="${post.source}" target="_blank">Fonte</a>`;
      document.getElementById('pvDefinition').innerHTML = `<p>${post.fullText}</p>`;
      document.getElementById('commentName').value = '';
      document.getElementById('commentAnon').checked = false;
      document.getElementById('commentText').value = '';
      document.getElementById('postView').style.display='flex';
      // bind submit
      const submit = document.getElementById('submitComment');
      submit.onclick = ()=>{ saveComment(id); };
      renderComments(id);
    }

    function commentsKey(id){ return `bluelava_comments_${id}` }
    function loadComments(id){ try{ return JSON.parse(localStorage.getItem(commentsKey(id))||'[]') }catch(e){return []} }
    function saveCommentsFor(id,arr){ localStorage.setItem(commentsKey(id), JSON.stringify(arr)); }

    function saveComment(postId){
      const name = document.getElementById('commentName').value.trim();
      const anon = document.getElementById('commentAnon').checked;
      const text = document.getElementById('commentText').value.trim();
      if(!text) return alert('Escreve a tua experi√™ncia antes de enviar.');
      const arr = loadComments(postId);
      const comment = {id:Date.now(),name: name||'',anon:anon, text:text, likes:0, ts:Date.now()};
      arr.unshift(comment);
      saveCommentsFor(postId,arr);
      document.getElementById('commentText').value='';
      renderComments(postId);
    }

    function renderComments(postId){
      const list = loadComments(postId);
      const container = document.getElementById('commentsList');
      if(!container) return;
      if(list.length===0){ container.innerHTML = '<p style="color:#666">Seja a primeira pessoa a partilhar ‚Äî tu podes ajudar algu√©m hoje.</p>'; return }
      container.innerHTML = list.map(c=>{
        const who = c.anon? 'An√≥nimo' : (c.name||'Sem nome');
        return `<div style="background:#f9f9f9;border-radius:8px;padding:10px;margin-bottom:8px"><div style="display:flex;justify-content:space-between;align-items:center"><strong>${who}</strong><small style="color:#666">${new Date(c.ts).toLocaleString()}</small></div><div style="margin-top:6px">${escapeHtml(c.text)}</div><div style="margin-top:8px"><button onclick="toggleLike(${postId},${c.id})" style="background:transparent;border:none;cursor:pointer">‚ù§ ${c.likes}</button></div></div>`
      }).join('');
    }

    function toggleLike(postId,commentId){
      const arr = loadComments(postId);
      const it = arr.find(c=>c.id===commentId); if(!it) return;
      it.likes = (it.likes||0) + 1;
      saveCommentsFor(postId,arr);
      renderComments(postId);
    }

    function escapeHtml(str){ return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }

    function openPost(id){alert('Abrir post '+id)}

    // init
    renderChart();
    filterPosts('all');
  </script>
</body>
</html>
