<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BlueLavaCommunity - Sa√∫de Mental</title>
    <!-- Icons for Discord and X (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4A90E2; /* Blue Lava */
            --accent: #FF5722;  /* Hot Lava (Orange) */
            --discord: #5865F2;
            --x-black: #000000;
            --bg: #f4f7f6;
            --white: #ffffff;
            --text: #333;
        }

        body { font-family: 'Roboto', sans-serif; background-color: var(--bg); margin: 0; color: var(--text); }

        /* HEADER */
        header { 
            background: linear-gradient(180deg, #000f2a, #2b4cb8, #1a5eb8, #002667);
            color: white; padding: 40px 20px; text-align: center; 
        }
        
        /* LOGO STYLING */
        .header-logo {
            max-width: 250px;
            height: auto;
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
            filter: drop-shadow(0 0 10px rgba(255,255,255,0.2));
        }

        header h1 { margin: 0; font-size: 3rem; letter-spacing: 2px; text-transform: uppercase; }
        header .subtitle { margin-top: 10px; opacity: 0.9; font-size: 1.2rem; }

        /* SOCIAL BUTTONS */
        .social-area { margin-top: 20px; display: flex; justify-content: center; gap: 15px; }
        .social-btn {
            text-decoration: none; padding: 10px 20px; border-radius: 30px; font-weight: bold; color: white;
            display: flex; align-items: center; gap: 10px; transition: transform 0.2s;
        }
        .social-btn:hover { transform: scale(1.05); }
        .btn-discord { background-color: var(--discord); }
        .btn-whatsapp { background-color: #25D366; }

        /* ALERT BAR */
        .stats-banner {
            background: var(--accent); color: white; padding: 12px; text-align: center;
            font-weight: bold; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* NAVIGATION TABS */
        nav { background: var(--white); box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; overflow-x: auto; }
        .nav-inner { max-width: 1100px; margin: 0 auto; display: flex; padding: 0 10px; }
        .tab-link {
            padding: 18px 20px; text-decoration: none; color: #555; font-weight: bold;
            text-transform: uppercase; font-size: 0.9rem; border-bottom: 4px solid transparent; cursor: pointer; white-space: nowrap;
        }
        .tab-link:hover { color: var(--primary); background: #f9f9f9; }
        .tab-link.active { color: var(--primary); border-bottom-color: var(--primary); }

        /* MAIN LAYOUT */
        .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
        
        /* GRID SYSTEM */
        .posts-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; }
        
        .post-card { 
            background: var(--white); border-radius: 10px; overflow: hidden; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.05); transition: transform 0.3s; cursor: pointer; border-top: 4px solid var(--primary);
        }
        .post-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .post-img { height: 200px; background-size: cover; background-position: center; background-color: #ddd; }
        .post-content { padding: 25px; }
        .post-tag { background: #e3f2fd; color: var(--primary); padding: 4px 10px; font-size: 0.75rem; border-radius: 20px; font-weight: bold; text-transform: uppercase; }
        .post-title { margin: 15px 0 10px 0; font-size: 1.4rem; color: #222; }
        .post-stat { color: var(--accent); font-weight: bold; font-size: 0.9rem; display: block; margin-bottom: 10px;}
        .read-more { color: var(--primary); font-weight: bold; margin-top: 15px; display: inline-block; font-size: 0.9rem; }

        /* SINGLE POST VIEW */
        .single-post-view { display: none; background: var(--white); padding: 40px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .back-btn { cursor: pointer; color: #777; font-weight: bold; margin-bottom: 20px; display: inline-block; }
        .back-btn:hover { color: var(--primary); }
        .article-img { width: 100%; height: 400px; object-fit: cover; border-radius: 8px; margin-bottom: 30px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* TESTIMONIALS & LIKES */
        .comments-wrapper { margin-top: 50px; border-top: 2px dashed #eee; padding-top: 30px; }
        .comment-box { background: #f8f9fa; padding: 25px; border-radius: 8px; margin-bottom: 30px; border: 1px solid #eee; }
        
        .testimony-item { display: flex; gap: 15px; margin-bottom: 25px; border-bottom: 1px solid #f0f0f0; padding-bottom: 20px; }
        .avatar { width: 45px; height: 45px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; font-size: 1.2rem; }
        .t-name { font-weight: bold; color: #222; display: block; }
        .t-text { margin-top: 5px; color: #555; line-height: 1.5; }
        
        .like-btn { 
            background: none; border: 1px solid #ddd; padding: 5px 12px; border-radius: 20px; 
            margin-top: 10px; cursor: pointer; color: #777; font-size: 0.9rem; display: flex; align-items: center; gap: 5px; transition: 0.2s;
        }
        .like-btn:hover { border-color: #FF9800; color: #FF9800; }
        .like-btn.liked { background-color: #FFF3E0; border-color: #FF9800; color: #FF9800; }

        /* FORM INPUTS */
        input, textarea { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ddd; border-radius: 6px; font-family: inherit; box-sizing: border-box; }
        button.submit-btn { background: var(--primary); color: white; border: none; padding: 12px 25px; cursor: pointer; font-weight: bold; border-radius: 6px; font-size: 1rem; }
        button.submit-btn:hover { background: #357ABD; }

        /* EXPERIENCE/DIFFICULTIES SECTION */
        .difficulties-wrapper { margin-top: 40px; border-top: 3px solid var(--accent); padding-top: 30px; background: #FFF8F0; padding: 25px; border-radius: 8px; }
        .difficulties-wrapper h3 { color: var(--accent); margin-top: 0; }
        .difficulty-post { background: var(--white); padding: 20px; margin-bottom: 20px; border-radius: 8px; border-left: 4px solid var(--accent); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .difficulty-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .difficulty-author { font-weight: bold; color: #222; }
        .difficulty-date { font-size: 0.85rem; color: #999; }
        .difficulty-text { color: #555; line-height: 1.6; margin: 10px 0; }
        .difficulty-category-tag { display: inline-block; background: var(--accent); color: white; padding: 3px 8px; border-radius: 20px; font-size: 0.75rem; margin-bottom: 10px; }


        /* MOBILE */
        @media(max-width: 600px) {
            header h1 { font-size: 2rem; }
            .social-area { flex-direction: column; align-items: center; }
            .social-btn { width: 80%; justify-content: center; }
            .container { padding: 0 15px; }
            .header-logo { max-width: 180px; }
            .article-img { height: 250px; }
        }
    </style>
</head>
<body>

    <div class="stats-banner">
        ‚ö†Ô∏è Estat√≠stica Nacional: 1 em cada 5 pessoas em Portugal sofre de uma perturba√ß√£o mental.
    </div>

    <header>
        <!-- LOGO DA BLUELAVA (Certifique-se que o ficheiro logo.svg est√° no GitHub) -->
        <img src="logo.png" alt="Blue Lava Logo" class="header-logo">
        
        <div style="font-family: 'Times New Roman', serif; font-size: 2rem; font-weight: bold; margin-bottom: 10px;"><span style="color: var(--accent);">Comunidade</span> <span style="color: var(--accent);">Blue Lava</span></div>
        <div class="subtitle">Apoio, Informa√ß√£o e Comunidade</div>
        
        <!-- BOT√ïES SOCIAIS ATUALIZADOS -->
        <div class="social-area">
            <a href="https://discord.gg/SEU_CODIGO" target="_blank" class="social-btn btn-discord">
                <i class="fa-brands fa-discord"></i> Entrar no Discord
            </a>
            <!-- LINK WHATSAPP AQUI üëá -->
            <a href="https://chat.whatsapp.com/Brbk55gFD3KG1UFx8DOEPs" target="_blank" class="social-btn btn-whatsapp">
                <i class="fa-brands fa-whatsapp"></i> Entrar no WhatsApp
            </a>
        </div>
    </header>

    <nav>
        <div class="nav-inner">
            <a class="tab-link active" onclick="filterPosts('all')">In√≠cio</a>
            <a class="tab-link" onclick="filterPosts('Ansiedade')">Ansiedade</a>
            <a class="tab-link" onclick="filterPosts('Ansiedade Leve')">Ansiedade Leve</a>
            <a class="tab-link" onclick="filterPosts('Depress√£o')">Depress√£o</a>
            <a class="tab-link" onclick="filterPosts('Stress')">Stress Cr√≥nico</a>
            <a class="tab-link" onclick="filterPosts('P√¢nico')">P√¢nico</a>
            <a class="tab-link" onclick="filterPosts('TOC')">TOC</a>
            <a class="tab-link" onclick="filterPosts('Burnout')">Burnout</a>
        </div>
    </nav>

    <div class="container">
        <!-- GRELHA PRINCIPAL -->
        <div id="posts-grid" class="posts-grid"></div>

        <!-- VISUALIZA√á√ÉO DO ARTIGO -->
        <div id="single-post" class="single-post-view">
            <div class="back-btn" onclick="showGrid()">‚Üê Voltar aos artigos</div>
            <h2 id="sp-title" style="margin-top:0; font-size:2.5rem; color:#333;"></h2>
            <div id="sp-stat" class="post-stat" style="font-size:1.1rem; margin-bottom:20px;"></div>
            <img id="sp-img" class="article-img" src="" alt="Imagem Art√≠stica da Doen√ßa">
            <div id="sp-content" style="line-height:1.8; font-size:1.1rem; color:#444; margin-bottom:40px;"></div>

            <!-- SEC√á√ÉO DE DIFICULDADES E EXPERI√äNCIAS -->
            <div class="difficulties-wrapper">
                <h3 id="difficulties-title">üÜò Partilhe as Suas Dificuldades e Experi√™ncias</h3>
                <p id="difficulties-desc">Esta √© uma comunidade segura. Conte-nos as suas lutas, estrat√©gias e vit√≥rias. Ningu√©m est√° sozinho.</p>
                
                <div class="comment-box">
                    <input type="text" id="new-difficulty-name" placeholder="Deixe em branco para partilhar anonimamente">
                    <textarea id="new-difficulty-text" rows="4" placeholder="Qual √© a sua maior dificuldade? Que estrat√©gias o/a ajudam?"></textarea>
                    <button class="submit-btn" onclick="addDifficulty()">Partilhar Anonimamente</button>
                </div>

                <div id="difficulties-list"></div>
            </div>

            <!-- SEC√á√ÉO DE TESTEMUNHOS -->
            <div class="comments-wrapper">
                <h3>üí¨ Testemunhos da Comunidade</h3>
                <p>O seu testemunho pode ajudar algu√©m. Partilhe a sua hist√≥ria (anonimamente ou com o seu nome).</p>
                
                <div class="comment-box">
                    <input type="text" id="new-name" placeholder="Deixe em branco para comentar anonimamente">
                    <textarea id="new-text" rows="3" placeholder="Como √© que lida com isto? Que estrat√©gias usa?"></textarea>
                    <button class="submit-btn" onclick="addComment()">Publicar Testemunho</button>
                </div>

                <div id="comments-list"></div>
            </div>
        </div>
    </div>

    <script>
        // --- BASE DE DADOS COM IMAGENS AI ---
        const posts = [
            {
                id: 1,
                category: "Ansiedade",
                title: "Perturba√ß√µes de Ansiedade",
                stat: "üìä 16,5% da popula√ß√£o portuguesa",
                img: "https://images.unsplash.com/photo-1506126613408-eca07ce68773?auto=format&fit=crop&w=800&q=80",
                desc: "A perturba√ß√£o mais frequente em Portugal. Sintomas incluem preocupa√ß√£o excessiva.",
                fullText: "Segundo o Estudo EpiRegi√µes (2013), a ansiedade afeta 16,5% da popula√ß√£o portuguesa. A ansiedade torna-se uma doen√ßa quando o medo √© desproporcional ao perigo. √â como ter um alarme de inc√™ndio no c√©rebro que n√£o se desliga. O tratamento passa por terapia cognitivo-comportamental e regula√ß√£o de estilo de vida.",
                comments: [{ name: "Mariana", text: "A terapia mudou a minha vida. Aprendi a respirar antes de entrar em p√¢nico.", likes: 15 }],
                difficulties: []
            },
            {
                id: 2,
                category: "Depress√£o",
                title: "Perturba√ß√µes Depressivas",
                stat: "üìä 7,9% da popula√ß√£o portuguesa",
                img: "https://images.unsplash.com/photo-1609207825381-85a04dbb0b26?auto=format&fit=crop&w=800&q=80",
                desc: "Tristeza profunda e persistente que retira o prazer de viver e afeta o sono.",
                fullText: "De acordo com o relat√≥rio de Sa√∫de Mental do INE (2019), a depress√£o afeta 7,9% da popula√ß√£o portuguesa. A depress√£o √© uma doen√ßa cl√≠nica, n√£o √© fraqueza. Afeta quimicamente o c√©rebro, alterando a percep√ß√£o da realidade. Estudos portugueses mostram que a terapia combinada com medica√ß√£o tem taxa de sucesso superior a 70%. Pedir ajuda √© o primeiro passo.",
                comments: [{ name: "Jo√£o", text: "N√£o desistam. A medica√ß√£o certa fez-me sair do fundo do po√ßo.", likes: 42 }],
                difficulties: []
            },
            {
                id: 3,
                category: "Fobias",
                title: "Fobias Espec√≠ficas",
                stat: "üìä Muito prevalente na popula√ß√£o",
                img: "https://images.unsplash.com/photo-1587825140708-dfaf72ae4b04?auto=format&fit=crop&w=800&q=80",
                desc: "Medo irracional de objetos ou situa√ß√µes (alturas, animais, espa√ßos fechados).",
                fullText: "As fobias levam ao evitamento extremo. A pessoa deixa de viver a vida normal para evitar o objeto do medo. A terapia de exposi√ß√£o √© altamente eficaz.",
                comments: [],
                difficulties: []
            },
            {
                id: 4,
                category: "TOC",
                title: "Perturba√ß√£o Obsessivo-Compulsiva",
                stat: "üìä 1-2% da popula√ß√£o portuguesa",
                img: "https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=800&q=80",
                desc: "Obsess√µes (pensamentos) e compuls√µes (rituais) que consomem tempo e energia.",
                fullText: "De acordo com estudos da Universidade de Lisboa, o TOC afeta 1-2% da popula√ß√£o portuguesa. Quem tem TOC sente que tem de realizar rituais para evitar que algo mau aconte√ßa. √â uma pris√£o mental de repeti√ß√£o, mas que pode ser controlada com ajuda m√©dica. Terapia cognitivo-comportamental e ISRS t√™m elevadas taxas de remiss√£o.",
                comments: [{ name: "Ana T.", text: "O meu TOC de organiza√ß√£o √© exaustivo mas control√°vel com ajuda.", likes: 8 }],
                difficulties: []
            },
            {
                id: 5,
                category: "Subst√¢ncias",
                title: "Uso de Subst√¢ncias",
                stat: "üìä Problema de sa√∫de p√∫blica",
                img: "https://images.unsplash.com/photo-1516062423079-7ca13cdc7f5a?auto=format&fit=crop&w=800&q=80",
                desc: "Depend√™ncia de √°lcool ou drogas que afeta a sa√∫de f√≠sica e mental.",
                fullText: "O v√≠cio √© muitas vezes uma fuga para a dor emocional. A recupera√ß√£o exige desintoxica√ß√£o f√≠sica e, acima de tudo, reconstru√ß√£o emocional.",
                comments: [],
                difficulties: []
            },
            {
                id: 6,
                category: "Impulsos",
                title: "Controlo de Impulsos",
                stat: "üìä Afeta a regula√ß√£o emocional",
                img: "https://images.unsplash.com/photo-1599058917212-d750089bc07e?auto=format&fit=crop&w=800&q=80",
                desc: "Dificuldade em resistir a um ato que √© prejudicial para si ou para os outros.",
                fullText: "Inclui cleptomania e explos√µes de raiva. √â como se o 'trav√£o' do c√©rebro falhasse momentaneamente perante um desejo intenso.",
                comments: [],
                difficulties: []
            },
            {
                id: 7,
                category: "Esquizofrenia",
                title: "Esquizofrenia",
                stat: "üìä Doen√ßa mental grave",
                img: "https://images.unsplash.com/photo-1552821248-5c51e1a3d5b1?auto=format&fit=crop&w=800&q=80",
                desc: "Altera a perce√ß√£o da realidade. Pode incluir alucina√ß√µes e del√≠rios.",
                fullText: "O estigma √© o pior inimigo. Pessoas com esquizofrenia podem levar vidas produtivas. A arte e a terapia ocupacional ajudam muito na reintegra√ß√£o.",
                comments: [{ name: "Ricardo", text: "Vivo com isto h√° 15 anos. A estabilidade √© poss√≠vel.", likes: 105 }],
                difficulties: []
            },
            {
                id: 8,
                category: "Stress",
                title: "Stress Cr√≥nico",
                stat: "üìä 25% experiencia stress cr√≥nico",
                img: "https://images.unsplash.com/photo-1544716278-ca5e3af4abd8?auto=format&fit=crop&w=800&q=80",
                desc: "Estados de tens√£o prolongada que afeta sa√∫de f√≠sica e mental.",
                fullText: "Segundo a Funda√ß√£o Portuguesa de Cardiologia (2021), cerca de 25% dos portugueses sofrem de stress cr√≥nico. O stress prolongado afeta o sistema imunit√°rio, cardiovascular e mental. Estudos portugueses mostram que t√©cnicas de mindfulness, exerc√≠cio regular e terapia reduzem significativamente os sintomas. O reconhecimento precoce √© fundamental para evitar consequ√™ncias graves.",
                comments: [],
                difficulties: []
            },
            {
                id: 9,
                category: "P√¢nico",
                title: "Perturba√ß√µes de P√¢nico",
                stat: "üìä 3-5% da popula√ß√£o portuguesa",
                img: "https://images.unsplash.com/photo-1527482797697-8795b1a55a45?auto=format&fit=crop&w=800&q=80",
                desc: "Ataques s√∫bitos de medo intenso com sintomas f√≠sicos avassaladores.",
                fullText: "Estudos da Cl√≠nica de Ansiedade da Universidade do Porto indicam que 3-5% dos portugueses sofrem ataques de p√¢nico. Caracteriza-se por crises s√∫bitas de medo extremo com sintomas como taquicardia, suores e sensa√ß√£o de morte iminente. Apesar dos sintomas assustadores, o p√¢nico √© trat√°vel. Terapia de exposi√ß√£o e t√©cnicas de respira√ß√£o t√™m comprovada efic√°cia em 80% dos casos.",
                comments: [],
                difficulties: []
            },
            {
                id: 10,
                category: "Burnout",
                title: "Burnout / Dist√∫rbios do Sono",
                stat: "üìä 30% sofre de ins√≥nia cr√≥nica",
                img: "https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?auto=format&fit=crop&w=800&q=80",
                desc: "Esgotamento f√≠sico e emocional causado por trabalho intenso e priva√ß√£o de sono.",
                fullText: "De acordo com a Associa√ß√£o Portuguesa de M√©dicos de Medicina Interna (2022), 30% dos portugueses sofre de ins√≥nia cr√≥nica, frequentemente associada a burnout profissional. O n√£o dormir adequadamente compromete a regula√ß√£o emocional e cognitiva. Estudos nacionais mostram que interven√ß√µes no ambiente de trabalho, higiene do sono e psicoterapia melhoram significativamente a qualidade de vida e produtividade.",
                comments: [],
                difficulties: []
            },
            {
                id: 11,
                category: "Ansiedade Leve",
                title: "Ansiedade Leve / Stress Emocional",
                stat: "üìä 45% experiencia ansiedade ocasional",
                img: "https://images.unsplash.com/photo-1516307365439-23cf4e348ca0?auto=format&fit=crop&w=800&q=80",
                desc: "Rea√ß√µes normais a situa√ß√µes desafiadoras que n√£o atingem n√≠vel cl√≠nico.",
                fullText: "Segundo dados do Instituto Nacional de Sa√∫de (2020), 45% dos portugueses experiencia ansiedade ocasional relacionada a situa√ß√µes de vida (apresenta√ß√µes, mudan√ßas, perdas). Esta ansiedade leve √© uma resposta normal ao stress e diferencia-se da perturba√ß√£o de ansiedade cl√≠nica. T√©cnicas simples como exerc√≠cio f√≠sico, medita√ß√£o e apoio social s√£o altamente eficazes na gest√£o. Quando persiste al√©m de 6 meses, recomenda-se apoio profissional.",
                comments: [],
                difficulties: []
            }
        ];

        let currentPostId = null;

        // --- FUN√á√ïES ---
        function init() { filterPosts('all'); }

        function filterPosts(cat) {
            document.getElementById('posts-grid').style.display = 'grid';
            document.getElementById('single-post').style.display = 'none';
            document.querySelectorAll('.tab-link').forEach(el => {
                el.classList.remove('active');
                if(el.innerText === cat || (cat === 'all' && el.innerText === 'IN√çCIO')) el.classList.add('active');
            });

            const grid = document.getElementById('posts-grid');
            grid.innerHTML = '';
            const filtered = cat === 'all' ? posts : posts.filter(p => p.category === cat);

            filtered.forEach(p => {
                grid.innerHTML += `
                    <div class="post-card" onclick="openPost(${p.id})">
                        <div class="post-img" style="background-image: url('${p.img}')"></div>
                        <div class="post-content">
                            <span class="post-tag">${p.category}</span>
                            <h3 class="post-title">${p.title}</h3>
                            <span class="post-stat">${p.stat}</span>
                            <p>${p.desc}</p>
                            <span class="read-more">Ler mais ‚Üí</span>
                        </div>
                    </div>
                `;
            });
        }

        function openPost(id) {
            currentPostId = id;
            const p = posts.find(x => x.id === id);
            document.getElementById('posts-grid').style.display = 'none';
            document.getElementById('single-post').style.display = 'block';
            window.scrollTo(0,0);

            document.getElementById('sp-title').innerText = p.title;
            document.getElementById('sp-stat').innerText = p.stat;
            document.getElementById('sp-content').innerText = p.fullText;
            document.getElementById('sp-img').src = p.img;
            
            // Atualizar mensagens din√¢micas baseadas na categoria
            document.getElementById('difficulties-title').innerText = `üÜò Partilha Anonimamente a Tua Experi√™ncia com ${p.title}`;
            document.getElementById('difficulties-desc').innerText = `Esta √© uma comunidade segura. Conte-nos as suas lutas, estrat√©gias e vit√≥rias relacionadas com ${p.title.toLowerCase()}. Ningu√©m est√° sozinho.`;
            
            renderComments(p);
            renderDifficulties(p);
        }

        function showGrid() {
            document.getElementById('posts-grid').style.display = 'grid';
            document.getElementById('single-post').style.display = 'none';
        }

        function renderComments(p) {
            const list = document.getElementById('comments-list');
            list.innerHTML = '';
            if(p.comments.length === 0) { list.innerHTML = '<p>Seja o primeiro a partilhar.</p>'; return; }
            
            p.comments.forEach((c, idx) => {
                list.innerHTML += `
                    <div class="testimony-item">
                        <div class="avatar">${c.name.charAt(0)}</div>
                        <div style="flex:1;">
                            <span class="t-name">${c.name}</span>
                            <div class="t-text">${c.text}</div>
                            <button class="like-btn" onclick="toggleLike(${p.id}, ${idx}, this)">
                                <span>üçø</span> <span>${c.likes}</span>
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        function toggleLike(pid, idx, btn) {
            const p = posts.find(x => x.id === pid);
            const span = btn.querySelector('span:last-child');

            if(btn.classList.contains('liked')) {
                p.comments[idx].likes--;
                btn.classList.remove('liked');
            } else {
                p.comments[idx].likes++;
                btn.classList.add('liked');
            }
            span.innerText = p.comments[idx].likes;
        }

        function addDifficulty() {
            const name = document.getElementById('new-difficulty-name').value.trim();
            const text = document.getElementById('new-difficulty-text').value.trim();
            if(!text) return alert("Partilhe a sua experi√™ncia.");
            
            const p = posts.find(x => x.id === currentPostId);
            if(!p.difficulties) p.difficulties = [];
            p.difficulties.unshift({ 
                name: name || "An√≥nimo", 
                text: text, 
                likes: 0,
                date: new Date().toLocaleDateString('pt-PT')
            });
            
            document.getElementById('new-difficulty-name').value = '';
            document.getElementById('new-difficulty-text').value = '';
            renderDifficulties(p);
        }

        function renderDifficulties(p) {
            const list = document.getElementById('difficulties-list');
            list.innerHTML = '';
            if(!p.difficulties || p.difficulties.length === 0) { 
                list.innerHTML = '<p>Seja o primeiro a partilhar a sua experi√™ncia.</p>'; 
                return; 
            }
            
            p.difficulties.forEach((d, idx) => {
                list.innerHTML += `
                    <div class="difficulty-post">
                        <div class="difficulty-header">
                            <div>
                                <div class="difficulty-author">${d.name}</div>
                                <div class="difficulty-date">${d.date}</div>
                            </div>
                        </div>
                        <div class="difficulty-text">${d.text}</div>
                        <button class="like-btn" onclick="toggleDifficultyLike(${p.id}, ${idx}, this)">
                            <span>üçø</span> <span>${d.likes}</span>
                        </button>
                    </div>
                `;
            });
        }

        function toggleDifficultyLike(pid, idx, btn) {
            const p = posts.find(x => x.id === pid);
            const span = btn.querySelector('span:last-child');

            if(btn.classList.contains('liked')) {
                p.difficulties[idx].likes--;
                btn.classList.remove('liked');
            } else {
                p.difficulties[idx].likes++;
                btn.classList.add('liked');
            }
            span.innerText = p.difficulties[idx].likes;
        }

        function addComment() {
            const name = document.getElementById('new-name').value.trim();
            const text = document.getElementById('new-text').value.trim();
            if(!text) return alert("Escreva um testemunho.");
            
            const p = posts.find(x => x.id === currentPostId);
            p.comments.unshift({ name: name || "An√≥nimo", text: text, likes: 0 });
            
            document.getElementById('new-name').value = '';
            document.getElementById('new-text').value = '';
            renderComments(p);
        }

        init();
    </script>
</body>
</html>